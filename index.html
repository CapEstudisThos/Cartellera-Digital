<!DOCTYPE html>
<html lang="ca">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cartelleria Institut</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #2d2d2a; /* #f7f7f7; */
      color: #eee;
      text-align: center;
      display: flex;
      justify-content: center; 
      align-items: center;
      height: 100vh;
    }
    .contenidor {
      width: 100%;
      /*height: 95%;*/
      /*background: #f8faf0;*/
      text-align: center;
      /*position: absolute;*/
    }
    .logo {
      position: fixed;
      top: 20px;
      left: 50px;
      width: 200px;
      height: auto;
      z-index: 1000;
    }
    #horaActual {
      /*position: fixed;*/
      /*bottom: 10px;
      right: 15px;*/
      background: rgba(255, 255, 255, 0.1);
      /*border: 1px solid #ccc;*/
      border-radius: 5px;
      padding: 6px 12px;
      font-size: 24px;
      font-weight: bold;
      color: #ff3;
      box-shadow: 0 0 6px rgba(0,0,0,0.2);
      z-index: 999;
    }
    .div-centre {
      width: 95%;
      height: 95%;
      background: #aaa133;
    } 
    .horaris {
      margin: 20px;
      font-size: 2em;
      padding: 1em;
      height: 100%;
      /*background: #aaa133;*/
    } 
    table {
      font-size: 0.8em;
      padding: 0.5em;
      overflow: visible;
      border-collapse: collapse;
      border-radius: 8px;
      width: 100%;
      /*height: 75%;*/
	}

    thead{
      box-shadow: 0 4px 4px rgba(0,0,0,0.2);
      border-bottom: 2px solid #1c1c1c;
    }
	thead th {
      background-color: #2196F3;
      color: white;
      padding: 10px;
      text-align: center;
      border: 0px solid #ccc;
    }
	tbody tr {
      background-color: #FFF176;
      color: 000;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);      
    }
    tbody tr:nth-child(even) {
      background-color: #FDD835;
    }
    td {
      padding: 10px;
      text-align: center;
      border-bottom: 1px solid #ccc;
    }
  
    img, iframe {
      max-width: 100%;
      max-height: 100%;
      width: auto; /*100%;*/
      height: auto; 
    }
    .imatge-amb-ombra {
      box-shadow: 0 10px 20px rgba(247, 250, 216, 1); /* X, Y, difusió, color */
      border-radius: 8px; /* opcional, per fer les vores arrodonides */
    }
    .scroll-img {
      position: relative; 
      animation: moureImatge 10s linear infinite; 
    }

    @keyframes moureImatge {
      0% {
        left: 100%;
      }
      100% {
        left: -100%;
      }
    }
    .fade-img {
      opacity: 0;
      animation: fadeInOut 8s ease-in-out infinite;
      max-width: 100%;
      height: auto; 
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3); /* X, Y, difusió, color */
      border-radius: 8px; /* opcional, per fer les vores arrodonides */
    }

    @keyframes fadeInOut {
      0%   { opacity: 0; }
      20%  { opacity: 1; }
      80%  { opacity: 1; }
      100% { opacity: 0; }
    }
    .fade-video {
      opacity: 0;
      animation: fadeIn 3s ease-in forwards;
      max-width: 100%; 
      width: 95%;
      height: 95%;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3); /* X, Y, difusió, color */
      border-radius: 8px; /* opcional, per fer les vores arrodonides */
    } 

    @keyframes fadeIn {
      0%   { opacity: 0; }
      100% { opacity: 1; }
    }    
    
    .text-marquee {
      color: #eee; 
      /*background: #aaa133;*/
      font-size: 100px;
      overflow: hidden;
      position: absolute; /*relative; */
      top: 150px;
      height: 150px;
      width: 100%;
      /* Full width of its parent */
      white-space: nowrap;     
      
    }
    .text-marquee span {
      position: absolute;
      /*width: auto;*/
      height: 100%;
      margin: 0;
      line-height: 150px;
      text-align: center;
      /* Start off the right edge */
      transform: translateX(100%);
      /* Animate to the left */
      animation: scroll-left 10s linear infinite;
    }
    @keyframes scroll-left {
      0% { transform: translateX(100%); }
      100% { transform: translateX(-200%); }
    }
  </style>
</head>
<body>
  
  <img class="logo" src="https://drive.google.com/thumbnail?id=1JUgMf-l53ZpiPQQiola2C8J25z6HdTnq&sz=w500" alt="Logo">
  
  <!--<div id="horaActual">Carregant hora...</div> -->
  
  <div class="contenidor" id="contenidor">Carregant...</div> 

  <!-- <div class="text-marquee"><span>Hola Ramon</span></div> -->

    
  <script>
    let pantalles = []; 
    let index = 0; 

    async function carregaPantalles() {  
      const resposta = await fetch("https://script.google.com/macros/s/AKfycbwglDau1iN8sEQ4_Md2cpChoj8w_y5zVS4rzLpZmfnbUWNGwNgVo_ixPFP2Gd4ofUILjw/exec");
      pantalles = await resposta.json();
    }
   
    function mostraPantalla(p) {
      const cont = document.getElementById("contenidor");
      cont.innerHTML = "";

      
      if (p.tipus === "horari") {
        const div = document.createElement("div");
        div.className = "horaris";
        const taula = document.createElement("table");
        const tcap = document.createElement("thead");
        
      	// Capçalera
  		const cap = document.createElement("tr");        
        //cap.innerHTML = "<th style='border:1px solid #fff'>Hora</th>";
  			p.materies[0].forEach(curs => {
              	const cdad = document.createElement("th");
    			cdad.innerHTML += `${curs}`; 
        		cap.appendChild(cdad);                          
	    	});        
        tcap.appendChild(cap);
      
        // Files de contingut
        const tbod = document.createElement("tbody");
  		for (let i = 1; i < p.materies.length; i++) {
    		const fila = document.createElement("tr");              
        	p.materies[i].forEach(materia => {
              const fdad = document.createElement("td");
              fdad.innerHTML += `${materia}`;
              fila.appendChild(fdad);              
           	});            
            tbod.appendChild(fila);      
      	}     

    	taula.appendChild(tcap);
        taula.appendChild(tbod);
    //div.innerHTML = `<h1>Classes Actuals</h1><p>${p.diahora}</p>`;
    div.innerHTML = `<h1>Classes Actuals</h1><p id="horaActual">...</p>`;
        
        div.appendChild(taula);
        cont.appendChild(div); 
        
      }
    
      
      else if (p.tipus === "imatge") {
        const img = document.createElement("img");
        img.src = p.url;
		//img.className = 'scroll-img';
        img.className = 'fade-img';
        cont.appendChild(img);
      }
      else if (p.tipus === "video") {
        const vid = document.createElement("iframe");
        vid.src = p.url + "?autoplay=1&mute=1";
        vid.allow = "autoplay";
        vid.frameBorder = 0;
		vid.className = 'fade-video';
        cont.appendChild(vid);
	  }
      else if (p.tipus === "text") {
        const div = document.createElement("div");
		div.className = "text-marquee";
    	const span = document.createElement("span");
        span.textContent = p.text; //= "Procés aprenentatge";
     	div.appendChild(span);
    	const maxHeight = window.innerHeight - div.offsetHeight;
    	const topRandom = Math.random() * maxHeight;
    	div.style.top = `${topRandom}px`;
        //div.textContent = p.text;
        cont.appendChild(div);
      }
    }

    async function iniciarCicle() {
      await carregaPantalles();
      if (pantalles.length === 0) return;
      mostraPantalla(pantalles[index]);
      setTimeout(() => {
        index = (index + 1) % pantalles.length;
        iniciarCicle();
      }, (pantalles[index].duracio || 10) * 1000);
    }

    iniciarCicle(); 
    
   function actualitzaHora() {
        const ara = new Date();
        const opcions = { day: '2-digit', month: 'long', year: '2-digit', hour: '2-digit', minute: '2-digit', second: '2-digit' };
        const formatHora = ara.toLocaleString('ca-ES', opcions);
        document.getElementById('horaActual').textContent = "Data: " + formatHora;
      }
      setInterval(actualitzaHora, 1000);
      actualitzaHora();
  </script>
</body>
</html>
